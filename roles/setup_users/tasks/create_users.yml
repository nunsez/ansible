---
- name: Create users
  become: yes
  user:
    name: "{{ user.name }}"
    password: "{{ user.password | default(user.name) }}"
    shell: "{{ user.shell | default('/bin/bash') }}"
    groups: "{{ user.groups | default(['sudo', 'adm']) }}"
    append: yes
    state: present
  loop: "{{ create_users }}"
  loop_control:
    loop_var: user
    label: "{{ user.name }}"
  when: create_users is defined
